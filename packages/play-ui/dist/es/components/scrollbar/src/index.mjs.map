{"version":3,"file":"index.mjs","sources":["../../../../../src/components/scrollbar/src/index.tsx"],"sourcesContent":["import { defineComponent, ref, watchEffect } from 'vue'\r\nimport type { ExtractPropTypes, PropType } from 'vue'\r\nimport { useExpose } from '../../../composables'\r\n\r\nexport type ScrollbarProps = ExtractPropTypes<typeof scrollbarProps>\r\nexport interface ScrollbarInstance extends HTMLElement {\r\n  scrollto(options: ScrollToOptions): void\r\n}\r\n\r\nconst scrollbarProps = {\r\n  height: {\r\n    type: Number,\r\n    default: 400,\r\n  },\r\n  minThumbSize: {\r\n    type: Number,\r\n    default: 20,\r\n  },\r\n  behavior: {\r\n    type: String as PropType<ScrollBehavior>,\r\n    default: 'auto',\r\n  },\r\n}\r\nexport default defineComponent({\r\n  name: 'Scrollbar',\r\n  props: scrollbarProps,\r\n  emits: ['scroll'],\r\n  setup(props, { slots, emit }) {\r\n    let beforeScrollTop = 0\r\n    let beforeScrollLeft = 0\r\n    const translateX = ref(0)\r\n    const translateY = ref(0)\r\n    const thumbWidth = ref(0)\r\n    const thumbHeight = ref(0)\r\n    const isShowBar = ref(false)\r\n    const isShowBarX = ref(false)\r\n    const isShowBarY = ref(false)\r\n    const wrpperEl = ref<HTMLElement>()\r\n    const thumbXEl = ref<HTMLElement>()\r\n    const thumbYEl = ref<HTMLElement>()\r\n\r\n    useExpose({\r\n      scrollto(options: ScrollToOptions) {\r\n        wrpperEl.value?.scrollTo(options)\r\n      },\r\n    })\r\n\r\n    const updateThumb = () => {\r\n      if (!wrpperEl?.value)\r\n        return\r\n\r\n      thumbHeight.value = Math.max(\r\n        wrpperEl.value.clientHeight ** 2 / wrpperEl.value.scrollHeight,\r\n        props.minThumbSize,\r\n      )\r\n      thumbWidth.value = Math.max(\r\n        wrpperEl.value.clientWidth ** 2 / wrpperEl.value.scrollWidth,\r\n        props.minThumbSize,\r\n      )\r\n    }\r\n\r\n    const scrollX = () => {\r\n      wrpperEl.value?.scrollTo({\r\n        left: wrpperEl.value.scrollWidth * (translateX.value / wrpperEl.value.clientWidth),\r\n        behavior: props.behavior,\r\n      })\r\n    }\r\n\r\n    const scrollY = () => {\r\n      wrpperEl.value?.scrollTo({\r\n        top: wrpperEl.value.scrollHeight * (translateY.value / wrpperEl.value.clientHeight),\r\n        behavior: props.behavior,\r\n      })\r\n    }\r\n\r\n    watchEffect(() => {\r\n      if (!wrpperEl?.value)\r\n        return\r\n\r\n      isShowBarY.value\r\n        = wrpperEl.value.clientHeight < wrpperEl.value.scrollHeight\r\n      isShowBarX.value\r\n        = wrpperEl.value.clientWidth < wrpperEl.value.scrollWidth\r\n      updateThumb()\r\n    })\r\n\r\n    const onMousedown = (isAxisY: boolean) => {\r\n      return (evt: MouseEvent) => {\r\n        if (!wrpperEl.value)\r\n          return\r\n\r\n        let moveStart = 0\r\n        let currentTranslate = 0\r\n        const isTrackEl = evt.target !== thumbXEl.value && evt.target !== thumbYEl.value\r\n\r\n        if (isAxisY) {\r\n          currentTranslate = translateY.value\r\n          moveStart = evt.screenY\r\n        }\r\n        else {\r\n          currentTranslate = translateX.value\r\n          moveStart = evt.screenX\r\n        }\r\n\r\n        if (isTrackEl) {\r\n          if (isAxisY) {\r\n            translateY.value = evt.offsetY - thumbHeight.value / 2\r\n            return scrollY()\r\n          }\r\n          translateX.value = evt.offsetX - thumbWidth.value / 2\r\n          return scrollX()\r\n        }\r\n\r\n        const movelistener = (evt: MouseEvent) => {\r\n          if (!wrpperEl.value)\r\n            return\r\n\r\n          const moveEnd = isAxisY ? evt.screenY : evt.screenX\r\n          if (isAxisY) {\r\n            translateY.value = Math.max(\r\n              Math.min(\r\n                currentTranslate + moveEnd - moveStart,\r\n                wrpperEl.value.clientHeight - thumbHeight.value,\r\n              ),\r\n              0,\r\n            )\r\n            return scrollY()\r\n          }\r\n          translateX.value = Math.max(\r\n            Math.min(\r\n              currentTranslate + moveEnd - moveStart,\r\n              wrpperEl.value.clientWidth - thumbWidth.value,\r\n            ),\r\n            0,\r\n          )\r\n          return scrollX()\r\n        }\r\n\r\n        const defaultSelectstart = document.onselectstart\r\n        const clean = () => {\r\n          document.removeEventListener('mousemove', movelistener)\r\n          document.removeEventListener('mouseup', clean)\r\n          document.onselectstart = defaultSelectstart\r\n        }\r\n        document.addEventListener('mousemove', movelistener)\r\n        document.addEventListener('mouseup', clean)\r\n        document.onselectstart = () => false\r\n      }\r\n    }\r\n\r\n    const onScroll = (evt: UIEvent) => {\r\n      const target = evt.target as HTMLElement\r\n      if (beforeScrollTop !== target.scrollTop) {\r\n        translateY.value\r\n          = (target.scrollTop * target.clientHeight) / target.scrollHeight\r\n        beforeScrollTop = target.scrollTop\r\n      }\r\n      if (beforeScrollLeft !== target.scrollLeft) {\r\n        translateX.value\r\n          = (target.scrollLeft * target.clientWidth) / target.scrollWidth\r\n        beforeScrollLeft = target.scrollLeft\r\n      }\r\n      updateThumb()\r\n      emit('scroll', evt)\r\n    }\r\n\r\n    const onMouseenter = () => {\r\n      isShowBar.value = true\r\n    }\r\n\r\n    const onMouseleave = () => {\r\n      isShowBar.value = false\r\n    }\r\n\r\n    return () => (\r\n      <div\r\n        class=\"pl-scrollbar\"\r\n        style={`height: ${props.height}px`}\r\n        onMouseenter={onMouseenter}\r\n        onMouseleave={onMouseleave}\r\n      >\r\n        <div ref={wrpperEl} class=\"pl-scrollbar-wrpper\" onScroll={onScroll}>\r\n          {slots.default?.()}\r\n        </div>\r\n        <div\r\n          class=\"pl-scrollbar-bar pl-scrollbar-bar--x\"\r\n          onMousedown={onMousedown(false)}\r\n        >\r\n          <div\r\n            ref={thumbXEl}\r\n            v-show={isShowBar.value && isShowBarX.value}\r\n            class=\"pl-scrollbar-bar-thumb pl-scrollbar-bar-thumb--x\"\r\n            style={`width: ${thumbWidth.value}px; transform: translateX(${translateX.value}px)`}\r\n          />\r\n        </div>\r\n        <div\r\n          class=\"pl-scrollbar-bar pl-scrollbar-bar--y\"\r\n          onMousedown={onMousedown(true)}\r\n        >\r\n          <div\r\n            ref={thumbYEl}\r\n            v-show={isShowBar.value && isShowBarY.value}\r\n            class=\"pl-scrollbar-bar-thumb pl-scrollbar-bar-thumb--y\"\r\n            style={`height: ${thumbHeight.value}px; transform: translateY(${translateY.value}px)`}\r\n          />\r\n        </div>\r\n      </div>\r\n    )\r\n  },\r\n})\r\n"],"names":["evt","_createVNode","_withDirectives","_vShow"],"mappings":"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"}