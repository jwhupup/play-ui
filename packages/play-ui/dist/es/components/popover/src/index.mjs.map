{"version":3,"file":"index.mjs","sources":["../../../../../src/components/popover/src/index.tsx"],"sourcesContent":["import { type ExtractPropTypes, type PropType, Transition, computed, defineComponent, onMounted, ref, watchEffect } from 'vue'\r\nimport { type Instance, type Placement, createPopper } from '@popperjs/core'\r\nimport { useOutside } from '../../../composables'\r\nimport { animation } from '../../../utils'\r\n\r\nexport type PopoverProps = ExtractPropTypes<typeof popoverProps>\r\n\r\nconst popoverProps = {\r\n  title: String,\r\n  content: String,\r\n  placement: {\r\n    type: String as PropType<Placement>,\r\n    default: 'auto',\r\n  },\r\n  trigger: {\r\n    type: String as PropType<'hover' | 'click'>,\r\n    default: 'hover',\r\n  },\r\n}\r\n\r\nexport default defineComponent({\r\n  name: 'Popover',\r\n  props: popoverProps,\r\n  setup(props, { slots }) {\r\n    let timer: NodeJS.Timeout\r\n    let flag = true\r\n    let popperInstance: Instance\r\n    const visible = ref(false)\r\n    const popover = ref<HTMLElement>()\r\n    const popoverBtn = ref<HTMLElement>()\r\n    const popoverContainer = ref<HTMLElement>()\r\n\r\n    onMounted(() => {\r\n      popperInstance = createPopper(popoverBtn.value!, popover.value!, {\r\n        placement: props.placement,\r\n        modifiers: [\r\n          {\r\n            name: 'offset',\r\n            options: {\r\n              offset: [0, 8],\r\n            },\r\n          },\r\n        ],\r\n      })\r\n    })\r\n\r\n    const visibleControl = (enabled: boolean) => {\r\n      visible.value = enabled\r\n      popperInstance.setOptions(options => ({\r\n        ...options,\r\n        modifiers: [\r\n          ...options.modifiers!,\r\n          { name: 'eventListeners', enabled },\r\n        ],\r\n      }))\r\n      enabled && popperInstance.update()\r\n    }\r\n\r\n    const onClick = () => {\r\n      if (!visible.value)\r\n        visibleControl(!visible.value)\r\n    }\r\n\r\n    const onBtnClick = (evt: MouseEvent) => {\r\n      if (props.trigger === 'click') {\r\n        evt.stopPropagation()\r\n        visibleControl(!visible.value)\r\n      }\r\n    }\r\n\r\n    const onMouseenter = () => {\r\n      flag = false\r\n      visibleControl(true)\r\n    }\r\n\r\n    const onMouseleave = () => {\r\n      flag = true\r\n      timer = setTimeout(() => {\r\n        clearTimeout(timer)\r\n        flag && visibleControl(false)\r\n      }, 300)\r\n    }\r\n\r\n    const eventProps = computed(() => {\r\n      if (props.trigger === 'hover')\r\n        return { onMouseenter, onMouseleave }\r\n\r\n      const { isOutside } = useOutside(popoverContainer, visible)\r\n      watchEffect(() => isOutside.value && (visible.value = false))\r\n      return { onClick }\r\n    })\r\n\r\n    const renderPopover = () => (\r\n      <>\r\n        <div>{props.title}</div>\r\n        <div>{props.content}</div>\r\n      </>\r\n    )\r\n\r\n    return () => (\r\n      <div\r\n        class='pl-popover'\r\n        ref={popoverContainer}\r\n        {...eventProps.value}\r\n      >\r\n        <Transition\r\n          enter-active-class={animation('fadeIn')}\r\n          leave-active-class={animation('fadeOut')}\r\n          appear\r\n        >\r\n          <div\r\n            id=\"pl-popover\"\r\n            ref={popover}\r\n            v-show={visible.value}\r\n            class={!slots.headless && 'pl-popover-content'}\r\n          >\r\n            {slots.headless?.() || slots.default?.() || renderPopover()}\r\n            {\r\n              slots.headless\r\n                ? null\r\n                : <div id=\"pl-popover-arrow\" data-popper-arrow />\r\n            }\r\n          </div>\r\n        </Transition>\r\n        <div\r\n          class='pl-popover-reference'\r\n          ref={popoverBtn}\r\n          onClick={onBtnClick}\r\n        >\r\n          {slots.reference?.()}\r\n        </div>\r\n      </div>\r\n    )\r\n  },\r\n})\r\n"],"names":["createPopper","_createVNode","_Fragment","_mergeProps","_withDirectives","_a","_vShow"],"mappings":"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"}