{"version":3,"file":"index.mjs","sources":["../../../../../src/components/virtual-list/src/index.tsx"],"sourcesContent":["import {\r\n  type CSSProperties,\r\n  type ExtractPropTypes,\r\n  type VNode,\r\n  computed,\r\n  defineComponent,\r\n  onMounted,\r\n  onUpdated,\r\n  ref,\r\n  watchEffect,\r\n} from 'vue'\r\nimport Scrollbar from '../../scrollbar'\r\nimport { range } from '../../../utils'\r\n\r\nexport type VirtualListProps = ExtractPropTypes<typeof virtualListProps>\r\n\r\nconst virtualListProps = {\r\n  listHeight: {\r\n    type: Number,\r\n    default: 400,\r\n  },\r\n  listItemCount: {\r\n    type: Number,\r\n    default: 0,\r\n  },\r\n  estimatedListItemHeight: {\r\n    type: Number,\r\n    required: true,\r\n  },\r\n}\r\n\r\nexport default defineComponent({\r\n  name: 'VirtualList',\r\n  props: virtualListProps,\r\n  setup(props, { slots }) {\r\n    const start = ref(0)\r\n    const end = ref(0)\r\n    const step = ref(0)\r\n    const translate = ref(0)\r\n    const listHeight = ref(0)\r\n    const scrollbarEl = ref<HTMLElement>()\r\n\r\n    const itemInfos = computed(() =>\r\n      range(1, props.listItemCount, 1).map((_, index) => ({\r\n        index,\r\n        height: props.estimatedListItemHeight,\r\n        top: props.estimatedListItemHeight! * index,\r\n        bottom: props.estimatedListItemHeight! * (index + 1),\r\n      })),\r\n    )\r\n\r\n    const updateTranslate = () => {\r\n      translate.value\r\n        = start.value >= 1 ? itemInfos.value[start.value - 1].bottom : 0\r\n    }\r\n\r\n    const getStart = (scrollTop = 0) => {\r\n      return itemInfos.value.find(item => item.bottom > scrollTop)?.index\r\n    }\r\n\r\n    const virtualAreaStyle = computed(() => ({\r\n      height: `${listHeight.value}px`,\r\n    }))\r\n\r\n    const realAreaStyle = computed<CSSProperties>(() => ({\r\n      position: 'absolute',\r\n      top: 0,\r\n      left: 0,\r\n      right: 0,\r\n      transform: `translateY(${translate.value}px)`,\r\n    }))\r\n\r\n    watchEffect(() => {\r\n      listHeight.value = props.estimatedListItemHeight! * props.listItemCount\r\n    })\r\n\r\n    onMounted(() => {\r\n      if (!scrollbarEl.value)\r\n        return\r\n      step.value = end.value = Math.ceil(\r\n        props.listHeight / props.estimatedListItemHeight!,\r\n      )\r\n    })\r\n\r\n    onUpdated(() => {\r\n      const items = document.querySelectorAll('.pl-virtual-list-item')\r\n      items.forEach((item, index) => {\r\n        const rect = item.getBoundingClientRect()\r\n        const height = rect.height\r\n        const diff = itemInfos.value[index].height! - height\r\n        if (diff) {\r\n          itemInfos.value[index].height = height\r\n          itemInfos.value[index].bottom = rect.bottom - diff\r\n          for (let j = index + 1; j < itemInfos.value.length; j++) {\r\n            itemInfos.value[j].top = itemInfos.value[j - 1].bottom\r\n            itemInfos.value[j].bottom = itemInfos.value[j].bottom - diff\r\n          }\r\n        }\r\n      })\r\n      listHeight.value = itemInfos.value[itemInfos.value.length - 1].bottom\r\n      updateTranslate()\r\n    })\r\n\r\n    const onScroll = (evt: UIEvent) => {\r\n      const scrollTop = (evt.target as HTMLElement).scrollTop\r\n      start.value = getStart(scrollTop)!\r\n      end.value = start.value + step.value\r\n      updateTranslate()\r\n    }\r\n\r\n    const renderVirtualList = () => (\r\n      <>\r\n        <div style={virtualAreaStyle.value} />\r\n        <div style={realAreaStyle.value}>\r\n          {(slots.default?.()[0].children as VNode[])?.slice(\r\n            start.value,\r\n            end.value,\r\n          )}\r\n        </div>\r\n      </>\r\n    )\r\n\r\n    return () => (\r\n      <Scrollbar\r\n        ref={scrollbarEl}\r\n        height={props.listHeight}\r\n        onScroll={onScroll}\r\n      >\r\n        {renderVirtualList()}\r\n      </Scrollbar>\r\n    )\r\n  },\r\n})\r\n"],"names":["_isVNode","_createVNode","_Fragment","Scrollbar"],"mappings":"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"}